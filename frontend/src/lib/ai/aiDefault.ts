export interface AISuggestion {
  templateName: string;
  levels: string[];
  example: string;
  reasoning: string;
}

export async function suggestTemplate(
  userInput: string
): Promise<AISuggestion> {
  console.log('๐ง ุงููุธุงู ุงูุฐูู ูุญูู ุทูุจู:', userInput);

  // ูุญุงูุงุฉ realistic ููุดุจูุฉ
  await new Promise((resolve) =>
    setTimeout(resolve, 800 + Math.random() * 700)
  );

  return analyzeInputIntelligently(userInput);
}

function analyzeInputIntelligently(input: string): AISuggestion {
  const text = input.toLowerCase().trim();

  // ูุงุนุฏุฉ ูุนุฑูุฉ ุดุงููุฉ ูุฐููุฉ
  const knowledgeBase = {
    // ุงูุชุนููู ูุงูุฏุฑุงุณุฉ
    education: {
      templateName: 'ุงููููู ุงูุฃูุงุฏููู ุงููุชูุฏู',
      levels: ['ุนุงู ุฏุฑุงุณู', 'ูุตู', 'ููุฑุฑ', 'ูุดุฑูุน', 'ูููุฉ'],
      example: '2024 โ ูุตู ุฑุจูุน โ ุงูุฐูุงุก ุงูุงุตุทูุงุนู โ ูุดุฑูุน ุงูุชุฎุฑุฌ โ ุจุญุซ ุนููู',
      reasoning: 'ูุตูู ููุชููุฒ ุงูุฃูุงุฏููู ูุงูุชูุธูู ุงูุฏุฑุงุณู ุงูุดุงูู',
    },

    // ุงูุชุทููุฑ ุงููููู
    career: {
      templateName: 'ูููู ุงูุชููุฒ ุงููุธููู',
      levels: [
        'ุฑุคูุฉ ููููุฉ',
        'ูุฏู ุงุณุชุฑุงุชูุฌู',
        'ูุดุฑูุน ุชุทููุฑ',
        'ุฎุทุฉ ุชูููุฐ',
        'ูููุฉ ุฃุณุจูุนูุฉ',
      ],
      example: 'ูุงุฆุฏ ุชููู โ ุดูุงุฏุฉ AWS โ ูุดุฑูุน ุชุฏุฑูุจ โ ุฎุทุฉ ุฏุฑุงุณุฉ โ ุชูุฑูู ุนููู',
      reasoning: 'ูุซุงูู ููุชูุฏู ุงูุณุฑูุน ูู ุงููุณุงุฑ ุงููุธููู ูุจูุงุก ุงูููุงุฑุงุช',
    },

    // ุงููุดุงุฑูุน ุงูุชูููุฉ
    tech: {
      templateName: 'ูููู ุชุทููุฑ ุงูุจุฑูุฌูุงุช',
      levels: [
        'ุฑุคูุฉ ุงูููุชุฌ',
        'ูุฑุญูุฉ ุชุทููุฑ',
        'ูููุฉ ุฑุฆูุณูุฉ',
        'ูููุฉ ูุฑุนูุฉ',
        'ููุฏ',
      ],
      example:
        'ุชุทุจูู ูุจูุนุงุช โ ูุฑุญูุฉ MVP โ ูุงุฌูุฉ ุงููุณุชุฎุฏู โ ุชุตููู ุงูุดุงุดุงุช โ ูุชุงุจุฉ ุงูููุฏ',
      reasoning: 'ูุตูู ุฎุตูุตุงู ูููุดุงุฑูุน ุงูุชูููุฉ ูุชุทููุฑ ุงูุชุทุจููุงุช',
    },

    // ุงูููุงูุฉ ูุงูุตุญุฉ
    health: {
      templateName: 'ูููู ุงูุชุญูู ุงูุตุญู',
      levels: ['ูุฏู ุตุญู', 'ูุฑุญูุฉ ุชุฏุฑูุจ', 'ุจุฑูุงูุฌ ุฃุณุจูุนู', 'ุฑูุชูู ูููู', 'ูุดุงุท'],
      example: 'ููุงูุฉ ูุชูุงููุฉ โ ุชุฃุณูุณ โ ูุงุฑุฏูู + ููุฉ โ ุตุจุงุญ โ ุฌุฑู 30 ุฏูููุฉ',
      reasoning: 'ูุซุงูู ูุชุญููู ุงูุชุญูู ุงูุตุญู ุงูุดุงูู ูุงูููุงูุฉ ุงููุณุชุฏุงูุฉ',
    },

    // ุฑูุงุฏุฉ ุงูุฃุนูุงู
    startup: {
      templateName: 'ูููู ุงูุดุฑูุฉ ุงููุงุดุฆุฉ',
      levels: ['ุฑุคูุฉ ุงูุดุฑูุฉ', 'ูุฏู ุฑุจุงุนู', 'ูุดุฑูุน ุญููู', 'ุฎุทุฉ ุชุดุบูู', 'ูููุฉ'],
      example:
        'ููุตุฉ ุชุนููููุฉ โ ููู ุงููุณุชุฎุฏู โ ุชุทููุฑ ุงููุญุชูู โ ุฎุทุฉ ุชุณููู โ ูุชุงุจุฉ ููุงู',
      reasoning: 'ูุตูู ูููุดุงุฑูุน ุงูุฑูุงุฏูุฉ ูุจูุงุก ุงูุดุฑูุงุช ุงููุงุดุฆุฉ',
    },

    // ุงูุชุทููุฑ ุงูุดุฎุตู
    personal: {
      templateName: 'ูููู ุงูููู ุงูุดุฎุตู',
      levels: [
        'ุฑุคูุฉ ุดุฎุตูุฉ',
        'ูุฏู ุชุทููุฑ',
        'ูุดุฑูุน ุชุญุณูู',
        'ุฎุทุฉ ุชุฏุฑูุจ',
        'ุนุงุฏุฉ ููููุฉ',
      ],
      example:
        'ุดุฎุตูุฉ ููุงุฏูุฉ โ ุฅุชูุงู ุงูุฅูุฌููุฒูุฉ โ ุฏูุฑุฉ ูุบุฉ โ ุฏุฑุงุณุฉ ููููุฉ โ ูุญุงุฏุซุฉ',
      reasoning: 'ูุซุงูู ูุชุทููุฑ ุงูููุงุฑุงุช ุงูุดุฎุตูุฉ ูุงููุฏุฑุงุช ุงูููุงุฏูุฉ',
    },

    // ุงูุฅุจุฏุงุน ูุงููููู
    creative: {
      templateName: 'ูููู ุงููุดุงุฑูุน ุงูุฅุจุฏุงุนูุฉ',
      levels: ['ุฑุคูุฉ ูููุฉ', 'ูุฑุญูุฉ ุฅูุชุงุฌ', 'ูููุฉ ุฅุจุฏุงุนูุฉ', 'ุฎุทูุฉ ุชูููุฐ', 'ุนูู'],
      example: 'ูุนุฑุถ ููู โ ุงูุชุตููู โ ููุญุฉ ุฑุฆูุณูุฉ โ ุฑุณู ูุจุฏุฆู โ ุชุฎุทูุท',
      reasoning: 'ูุตูู ูููุดุงุฑูุน ุงููููุฉ ูุงูุฅุจุฏุงุนูุฉ ูุงูุฃุนูุงู ุงููุฏููุฉ',
    },
  };

  // ุชุญููู ุฐูู ูุชูุฏู ูุน ููู ุงูุณูุงู
  const analysis = analyzeContext(text);

  switch (analysis.category) {
    case 'education':
      return knowledgeBase.education;
    case 'career':
      return knowledgeBase.career;
    case 'technology':
      return knowledgeBase.tech;
    case 'health':
      return knowledgeBase.health;
    case 'business':
      return knowledgeBase.startup;
    case 'personal':
      return knowledgeBase.personal;
    case 'creative':
      return knowledgeBase.creative;
    default:
      return getSmartDefaultTemplate(text);
  }
}

function analyzeContext(text: string): {
  category: string;
  confidence: number;
} {
  // ุฎูุงุฑุฒููุฉ ุชุญููู ุฐููุฉ
  const keywords = {
    education: [
      'ุฏุฑุงุณ',
      'ุฌุงูุน',
      'ุชุนููู',
      'ุทุงูุจ',
      'ุงูุชุญุงู',
      'ูุงุฏุฉ',
      'ูุตู',
      'ูุชุงุจ',
      'ุจุญุซ',
      'ุฃูุงุฏูู',
    ],
    career: [
      'ุนูู',
      'ูุธูู',
      'ูููุฉ',
      'ุฑุงุชุจ',
      'ุชุฑููุฉ',
      'ุดุฑูุฉ',
      'ูููู',
      'ูุธููุฉ',
      'ูุธุงุฆู',
      'ุชูุธูู',
    ],
    technology: [
      'ูุดุฑูุน',
      'ุชุทุจูู',
      'ุจุฑูุฌุฉ',
      'ุชุตููู',
      'ุชุทููุฑ',
      'ุจุฑูุฌ',
      'ุณููุชููุฑ',
      'ููุฏ',
      'ุจุฑูุงูุฌ',
      'ุชูููููุฌูุง',
    ],
    health: [
      'ุฑูุงุถ',
      'ุชูุงุฑูู',
      'ููุงูุฉ',
      'ุฌูู',
      'ูุฒู',
      'ุตุญุฉ',
      'ุบุฐุงุก',
      'ุฑูุงุถุฉ',
      'ุชุฏุฑูุจ',
      'ููุงู',
    ],
    business: [
      'ุดุฑูุฉ',
      'ุฑูุงุฏุฉ',
      'ุฃุนูุงู',
      'ุชุฌุงุฑุฉ',
      'ูุจูุนุงุช',
      'ุฑุจุญ',
      'ุงุณุชุซูุงุฑ',
      'ุณูู',
      'ููุชุฌ',
      'ูุดุฑูุน',
    ],
    personal: [
      'ุชุทููุฑ',
      'ุดุฎุตู',
      'ููุงุฑ',
      'ููุณ',
      'ุฐุงุช',
      'ููู',
      'ุชุญุณูู',
      'ูุฏุฑุงุช',
      'ุดุฎุตูุฉ',
    ],
    creative: [
      'ูู',
      'ุฑุณู',
      'ุชุตููู',
      'ุฅุจุฏุงุน',
      'ููุณููู',
      'ูุชุงุจุฉ',
      'ุฅูุชุงุฌ',
      'ุฅุฎุฑุงุฌ',
      'ููู',
    ],
  };

  let bestMatch = { category: 'default', confidence: 0 };

  Object.entries(keywords).forEach(([category, words]) => {
    const matches = words.filter((word) => text.includes(word)).length;
    const confidence = matches / words.length;

    if (confidence > bestMatch.confidence) {
      bestMatch = { category, confidence };
    }
  });

  return bestMatch.confidence >= 0.1
    ? bestMatch
    : { category: 'default', confidence: 0 };
}

function getSmartDefaultTemplate(text: string): AISuggestion {
  // ูููู ุฐูู ูุชููู ูุน ุทุจูุนุฉ ุงููุต
  const hasLongTerm = ['ูุณุชูุจู', 'ุทููู', 'ูุฏู', 'ุญูุงุฉ', 'ูุณุชูุจูู', 'ุจุนูุฏ'].some(
    (t) => text.includes(t)
  );
  const hasQuick = ['ุณุฑูุน', 'ููุฑู', 'ุนุงุฌู', 'ุขูู', 'ุขู', 'ุงูุญุงูู'].some((t) =>
    text.includes(t)
  );

  if (hasLongTerm) {
    return {
      templateName: 'ูููู ุงูุชุฎุทูุท ุงูุงุณุชุฑุงุชูุฌู',
      levels: [
        'ุฑุคูุฉ ูุณุชูุจููุฉ',
        'ูุฏู ุทููู ุงููุฏู',
        'ุฎุทุฉ ุฒูููุฉ',
        'ูุดุฑูุน ุชูููุฐู',
        'ูููุฉ ุนูููุฉ',
      ],
      example:
        'ุญูุงุฉ ูุชูุงุฒูุฉ โ ุงุณุชูุฑุงุฑ ูุงูู โ ุฎุทุฉ 5 ุณููุงุช โ ูุดุฑูุน ุงุณุชุซูุงุฑู โ ุฏุฑุงุณุฉ ุณูู',
      reasoning: 'ูุตูู ููุฃูุฏุงู ุทูููุฉ ุงููุฏู ูุงูุชุฎุทูุท ุงูุงุณุชุฑุงุชูุฌู ููุญูุงุฉ',
    };
  }

  if (hasQuick) {
    return {
      templateName: 'ูููู ุงูุฅูุฌุงุฒ ุงูุณุฑูุน',
      levels: ['ูุฏู ูุจุงุดุฑ', 'ุฎุทุฉ ุณุฑูุนุฉ', 'ูููุฉ ุนุงุฌูุฉ', 'ุฅุฌุฑุงุก ููุฑู', 'ูุชุงุฆุฌ'],
      example:
        'ุฅููุงุก ุงูุชูุฑูุฑ โ ุชูุณูู ุงูููุงู โ ูุชุงุจุฉ ุงูุฌุฒุก ุงูุฃูู โ ูุฑุงุฌุนุฉ โ ุชุณููู',
      reasoning: 'ูุซุงูู ููููุงู ุงูุนุงุฌูุฉ ูุงูุฃูุฏุงู ูุตูุฑุฉ ุงููุฏู',
    };
  }

  // ุงููููู ุงูุฐูู ุงูุนุงู
  return {
    templateName: 'ูููู ุงููุฌุงุญ ุงูุฐูู',
    levels: [
      'ุฑุคูุฉ ูุงุถุญุฉ',
      'ูุฏู ุฐูู',
      'ุฎุทุฉ ุนูููุฉ',
      'ุชูููุฐ ูููุฌู',
      'ุชูููู ูุณุชูุฑ',
    ],
    example:
      'ุชุญููู ุงูุทููุญ โ ูุฏู ูุญุฏุฏ ููุงุจู ููููุงุณ โ ุฎุทุฉ ูุงูุนูุฉ โ ุฎุทูุงุช ูููุฌูุฉ โ ูุฑุงุฌุนุฉ ูุชุญุณูู',
    reasoning: 'ูููู ูุฑู ุฐูู ููุงุณุจ ุฌููุน ุงูุฃูุฏุงู ููุถูู ุงูุงุณุชูุฑุงุฑูุฉ ูุงููุฌุงุญ',
  };
}
